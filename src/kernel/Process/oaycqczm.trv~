#include "Thread.h"

#include <iostream>

#include "ProcessManager.h"


void Thread::Thread_Func() {
	Set_Running();
	program(regs);

	// Program dobehl, takze muzeme notifikovat vsechny subscribery
	Set_Finished();
	Notify_Subscribers(tid);

	// Nastavime exit code

	// Pokud je toto vlakno main, ukoncime proces
	if (is_main_thread) {
		ProcessManager::Get().Terminate_Process(pid);
	}
}

std::thread::id Thread::Dispatch() {
	auto thread = std::thread(&Thread::Thread_Func, this);
	const auto thread_id = thread.get_id();
	thread.detach(); // vlakno musime detachnout
	return thread_id; // vratime thread id
}
